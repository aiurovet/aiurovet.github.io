////////////////////////////////////////////////////////////////////////////////
// Copyright (C) Alexander Iurovetski 2024
// All rights reserved under MIT license (see LICENSE file)
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Current page's entry point
////////////////////////////////////////////////////////////////////////////////

$(document).ready(async () => {
  CanExport = navigator.clipboard.writeText ? true : false;
  loadPref();
  initPref();
});

////////////////////////////////////////////////////////////////////////////////

$(window).bind("beforeunload", async (event) => {
  setListNo(ListNo, true);

  if (Data.Options.IsChanged) {
    Data.Options.IsChanged = false;
    await savePrefEx();
  }

  event.returnValue = null;
});

////////////////////////////////////////////////////////////////////////////////

$(window).resize(function () {
  setWordNo(WordNo);
});

////////////////////////////////////////////////////////////////////////////////
// Go to the first word
////////////////////////////////////////////////////////////////////////////////

function onClickFirstWord() {
  setWordNo(0);
}

////////////////////////////////////////////////////////////////////////////////
// Go to the last word
////////////////////////////////////////////////////////////////////////////////

function onClickLastWord() {
  setWordNo(-1);
}

////////////////////////////////////////////////////////////////////////////////
// Go to the menu
////////////////////////////////////////////////////////////////////////////////

function onClickMenu() {
  setPopup(true);
  onClickHelp(false);
}

////////////////////////////////////////////////////////////////////////////////
// Go to the next word
////////////////////////////////////////////////////////////////////////////////

function onClickNextWord() {
  setWordNo(WordNo + 1);
}

////////////////////////////////////////////////////////////////////////////////
// Go to the previous word
////////////////////////////////////////////////////////////////////////////////

function onClickPrevWord() {
  setWordNo(WordNo - 1);
}

////////////////////////////////////////////////////////////////////////////////
// Search selected word depending on options (all, images only, nothing)
////////////////////////////////////////////////////////////////////////////////

function onClickWord() {
  var mode = Data.Options.Search;

  if (mode) {
    mode = mode.trim();
  }

  if (!mode) {
    return;
  }

  switch (mode[0].toLowerCase()) {
    case 'a':
      mode = "";
      break;
    case 'i':
      mode = "&udm=2";
      break;
    default:
      return;
  }

  var word = encodeURIComponent($("#main-word").text().toLowerCase());

  window.open(`https://www.google.com/search?q=${word}${mode}`);
}

////////////////////////////////////////////////////////////////////////////////