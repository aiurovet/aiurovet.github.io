////////////////////////////////////////////////////////////////////////////////
// Copyright (C) Alexander Iurovetski 2024
// All rights reserved under MIT license (see LICENSE file)
//
// Main page
////////////////////////////////////////////////////////////////////////////////

'use strict';

////////////////////////////////////////////////////////////////////////////////
// Global variables (singlwtons)
////////////////////////////////////////////////////////////////////////////////

var Clip = null;
var Core = null;
var Json = null;
var Data = null;
var Main = null;
var Pref = null;

////////////////////////////////////////////////////////////////////////////////
// Application enrty point
////////////////////////////////////////////////////////////////////////////////

$(document).ready(() => {
  // Initialize global variables
  //
  Clip = new ClipClass();
  Core = new CoreClass();
  Json = new JsonClass();
  Data = (new DataClass()).load();
  Main = new MainClass();
  Pref = new PrefClass();

  // Initialize the UI
  //
  Core.setWordNo(Data.wordNo);
  Data.load();
  Pref.init(true);
});


////////////////////////////////////////////////////////////////////////////////
// Set the event handlers
////////////////////////////////////////////////////////////////////////////////

$(window).bind("beforeunload", async () => {
  await Pref.onClickExit();
});

$(window).resize(() => {
  Core.setWordNo(Data.wordNo);
});

////////////////////////////////////////////////////////////////////////////////

class MainClass {
  constructor() {
  }

  //////////////////////////////////////////////////////////////////////////////
  // Go to the first word
  //////////////////////////////////////////////////////////////////////////////

  onClickFirstWord() {
    setWordNo(0);
  }

  //////////////////////////////////////////////////////////////////////////////
  // Go to the last word
  //////////////////////////////////////////////////////////////////////////////

  onClickLastWord() {
    setWordNo(-1);
  }

  //////////////////////////////////////////////////////////////////////////////
  // Go to the menu
  //////////////////////////////////////////////////////////////////////////////

  onClickMenu() {
    Core.setPopup(true);
    Pref.onClickHelp(false);
  }

  //////////////////////////////////////////////////////////////////////////////
  // Go to the next word
  //////////////////////////////////////////////////////////////////////////////

  onClickNextWord() {
    Core.setWordNo(Data.wordNo + 1);
  }

  //////////////////////////////////////////////////////////////////////////////
  // Go to the previous word
  //////////////////////////////////////////////////////////////////////////////

  onClickPrevWord() {
    Core.setWordNo(Data.wordNo - 1);
  }

  //////////////////////////////////////////////////////////////////////////////
  // Search selected word depending on options (all, images only, nothing)
  //////////////////////////////////////////////////////////////////////////////

  onClickWord() {
    var mode = Data.search;

    if (mode) {
      mode = mode.trim();
    }

    if (!mode) {
      return;
    }

    switch (mode[0].toLowerCase()) {
      case 'a':
        mode = "";
        break;
      case 'i':
        mode = "&udm=2";
        break;
      default:
        return;
    }

    var word = encodeURIComponent($("#main-word").text().toLowerCase());

    window.open(`https://www.google.com/search?q=${word}${mode}`);
  }

  //////////////////////////////////////////////////////////////////////////////
}