////////////////////////////////////////////////////////////////////////////////
// Copyright (C) Alexander Iurovetski 2024
// All rights reserved under MIT license (see LICENSE file)
////////////////////////////////////////////////////////////////////////////////

"use strict";

////////////////////////////////////////////////////////////////////////////////

var MainToolFullWidthRatio = 0.20;
var MainToolFontRatio = 0.33;
var MinMainToolFontSize = 32;

////////////////////////////////////////////////////////////////////////////////

class CoreClass {
  constructor() {
  }

  //////////////////////////////////////////////////////////////////////////////
  // Get wordlists editor's jQuery element
  //////////////////////////////////////////////////////////////////////////////

  getEditor() {
    return $("#lists");
  }

  //////////////////////////////////////////////////////////////////////////////
  // Standard error handler
  //////////////////////////////////////////////////////////////////////////////

  onError(e, message) {
    alert(message ?? e.message);

    if (e) {
      throw e;
    }
  }

  //////////////////////////////////////////////////////////////////////////////
  // Set focus to the editor element
  //////////////////////////////////////////////////////////////////////////////

  setFocusToEditor() {
    this.getEditor().focus();
  }

  //////////////////////////////////////////////////////////////////////////////
  // Switch views from main to preferences and back
  //////////////////////////////////////////////////////////////////////////////

  setPopup(isVisible) {
    this.setVisible($(".popup-container"), isVisible);
  }

  //////////////////////////////////////////////////////////////////////////////
  // Change visibility status
  //////////////////////////////////////////////////////////////////////////////

  setVisible(jqElem, isVisible, style) {
    jqElem.css("display", isVisible ? style ?? "block" : "none");
  }

  //////////////////////////////////////////////////////////////////////////////
  // Calculates max char width, sets font size and text
  //////////////////////////////////////////////////////////////////////////////

  setWord(text) {
    var maxCharWidth = this._getMaxCharWidth();

    if (maxCharWidth > 0) {
      var mainToolFontSize = maxCharWidth * MainToolFontRatio;

      if (mainToolFontSize < MinMainToolFontSize) {
        mainToolFontSize = MinMainToolFontSize;
      }

      $(".main-word").css("font-size", `${maxCharWidth}px`);
      $(".main-tool").css("font-size", `${mainToolFontSize}px`);
    }

    $("#main-word").text(text);
  }

  //////////////////////////////////////////////////////////////////////////////
  // Sets the word from the list by its number
  //////////////////////////////////////////////////////////////////////////////

  setWordNo(wordNo) {
    var wordCount = Data.list.length;

    if (wordCount <= 0) {
      Data.wordNo = 0;
      this.setWord("");
      return;
    }

    if (wordNo < 0) {
      wordNo = wordCount - 1;
    }

    if (wordNo >= wordCount) {
      wordNo = 0;
    }

    Data.wordNo = wordNo;

    this.setWord(Data.list[Data.wordNo]);
  }

  //
  // PRIVATE
  //

  //////////////////////////////////////////////////////////////////////////////
  // Returns max char width assuming the font is fixed width (monospace)
  //////////////////////////////////////////////////////////////////////////////

  _getMaxCharWidth() {
    var jqFull = $(window);
    var maxWidth = jqFull.width();
    var maxCharWidth = Math.floor(maxWidth / Data.maxWordLength);
    var maxCharHeight = parseInt(jqFull.height() * 0.40);

    return maxCharWidth <= maxCharHeight ? maxCharWidth : maxCharHeight;
  }

  //////////////////////////////////////////////////////////////////////////////
}